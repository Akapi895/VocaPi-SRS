<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab SRS - Analytics Dashboard</title>
    <link rel="stylesheet" href="../css/analytics.css">
    <link rel="stylesheet" href="../css/gamification.css">
    <!-- Chart.js will be loaded locally if available, otherwise fallback charts will be used -->
</head>
<body>
    <div class="analytics-container">
        <!-- Gamification Section -->
        <div id="gamification-dashboard">
            <!-- Gamification content will be rendered here -->
        </div>

        <!-- Header -->
        <div class="analytics-header">
            <div class="header-left">
                <button id="back-to-main" class="btn btn-outline">
                    <span class="btn-icon">←</span> Back to Main
                </button>
            </div>
            <div class="header-center">
                <h1 class="analytics-title">
                    <span class="title-icon">📊</span>
                    <span class="title-text">Learning Analytics</span>
                </h1>
                <p class="analytics-subtitle">Your learning journey insights</p>
            </div>
            <div class="header-right">
                <button id="refresh-analytics" class="btn btn-outline">
                    <span class="btn-icon">🔄</span> Refresh
                </button>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-overview">
            <div class="stat-card primary">
                <div class="stat-icon">📚</div>
                <div class="stat-content">
                    <div class="stat-number" id="total-words">0</div>
                    <div class="stat-label">Total Words Learned</div>
                </div>
            </div>
            <div class="stat-card success">
                <div class="stat-icon">🔥</div>
                <div class="stat-content">
                    <div class="stat-number" id="current-streak">0 days</div>
                    <div class="stat-label">Current Streak</div>
                </div>
            </div>
            
            <div class="stat-card warning">
                <div class="stat-icon">⏱️</div>
                <div class="stat-content">
                    <div class="stat-number" id="total-time">0h</div>
                    <div class="stat-label">Time Spent Learning</div>
                </div>
            </div>
            
            <div class="stat-card info">
                <div class="stat-icon">🎯</div>
                <div class="stat-content">
                    <div class="stat-number" id="today-accuracy">0%</div>
                    <div class="stat-label">Today's Accuracy</div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-container">
                <div class="chart-header">
                    <h3>📈 Weekly Progress</h3>
                    <p>Your learning activity over the past 7 days</p>
                </div>
                <canvas id="weekly-progress-chart"></canvas>
            </div>
            
            <div class="chart-container">
                <div class="chart-header">
                    <h3>🎯 Quality Distribution</h3>
                    <p>How well you're mastering new words</p>
                </div>
                <canvas id="quality-chart"></canvas>
            </div>
        </div>

        <!-- Achievements Section -->
        <div class="achievements-section">
            <div class="section-header">
                <h3>🏆 Recent Achievements</h3>
                <div class="xp-display">
                    <span class="xp-label">Total XP:</span>
                    <span class="xp-value" id="total-xp">0</span>
                </div>
            </div>
            <div class="achievements-grid" id="achievements-grid">
                <!-- Achievements will be loaded dynamically -->
            </div>
        </div>

        <!-- Difficult Words Section -->
        <div class="difficult-words-section">
            <div class="section-header">
                <h3>⚠️ Words That Need More Practice</h3>
                <p>Focus on these words in your next review session</p>
            </div>
            <div class="difficult-words-list" id="difficult-words-list">
                <!-- Difficult words will be loaded dynamically -->
            </div>
        </div>

        <!-- Learning Patterns -->
        <div class="patterns-section">
            <div class="section-header">
                <h3>📊 Learning Patterns</h3>
            </div>
            <div class="patterns-grid">
                <div class="pattern-card">
                    <div class="pattern-icon">🌅</div>
                    <div class="pattern-content">
                        <div class="pattern-title">Best Study Time</div>
                        <div class="pattern-value" id="best-study-time">Morning</div>
                    </div>
                </div>
                
                <div class="pattern-card">
                    <div class="pattern-icon">📅</div>
                    <div class="pattern-content">
                        <div class="pattern-title">Most Active Day</div>
                        <div class="pattern-value" id="most-active-day">Monday</div>
                    </div>
                </div>
                
                <div class="pattern-card">
                    <div class="pattern-icon">⚡</div>
                    <div class="pattern-content">
                        <div class="pattern-title">Avg. Session Length</div>
                        <div class="pattern-value" id="avg-session-length">15 min</div>
                    </div>
                </div>
                
                <div class="pattern-card">
                    <div class="pattern-icon">🎯</div>
                    <div class="pattern-content">
                        <div class="pattern-title">Overall Accuracy</div>
                        <div class="pattern-value" id="overall-accuracy">85%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading-state" id="loading-state">
            <div class="spinner"></div>
            <p>Loading your analytics...</p>
        </div>
        
        <!-- Error State -->
        <div class="error-state" id="error-state" style="display: none;">
            <div class="error-icon">⚠️</div>
            <p id="error-message">Failed to load analytics</p>
            <button id="retry-analytics" class="btn btn-primary">Try Again</button>
        </div>
    </div>

    <!-- Core utilities (unified) -->
    <script src="../../core/utils.js"></script>
    <!-- Analytics system -->
    <script src="../js/analytics.js"></script>
    <!-- Gamification dependencies -->
    <script src="../js/gamification.js"></script>
    <script src="../js/gamificationUI.js"></script>
    <!-- Full dashboard controller (new) -->
    <script src="../js/analytics-dashboard.js"></script>
    <!-- Optional simple fallback (keep but load after main so it can early-exit if full dashboard present) -->
    <script src="../js/simple-analytics-dashboard.js" defer></script>
    <script src="../js/storage-debug.js" defer></script>
</body>
</html>